---
title: "Redis を理解する"
date: 2023-12-16T09:37:49+09:00
draft: true
---

業務で Redis をよく使うのだが、手順にしたがってコマンドを叩いているだけで全然理解できていなかったので、改めてちゃんと理解しようと思った。

## 業務で使っているコマンドを理解する

```sh
redis-cli -h redis03.local -n 2 keys "*hoge*" | xargs redis-cli -h redis03.local -n 2 DEL
```

- `redis-cli` : 文字通り redis の cli を実行するコマンド
- `-h redis03.local` : 文字通り redis サーバーのホスト
- `-n 2` : データベースの番号を指定。デフォルトは `0`
- `keys "*hoge*"` : redis のキーのパターンマッチ
- `xargs` : 標準入力から受け取ったデータを他のコマンドの引数として渡すコマンド。上記の場合、 `|` 以前のコマンド実行結果を `DEL` の引数として渡すことになる。
- `DEL` : DEL の引数に指定したキーを削除するコマンド

`|` 前のコマンドを実行してみる。

```sh
$ redis-cli keys "*hoge*"
1) "hoge-fuga"
2) "hoge"
3) "hoge-fuga-piyo"
```

つまり、`keys` でパターンマッチした結果を `DEL` の引数として渡すことで削除しているということ。

完全に理解した！（このコマンドについては）

## もっとちゃんと理解しよう

### redis-cli
`redis-cli` はコマンドを続けて書けば、そのまま結果を返してくれる。ただ、コマンドを書かなければ対話モードに入る。

```sh
$ redis-cli
127.0.0.1:6379> GET hoge
"hoge\\nhoge"
127.0.0.1:6379>
```

上記は、対話モードで `hoge` キーの中身を取得している。

### SET
`SET key "value"` でキーと値がセットできる。

```sh
$ redis-cli SET hoge "hoge\nhoge"
OK
$ redis-cli keys "*hoge*"
1) "hoge"
```

```sh
127.0.0.1:6379> SET fuga "テストだよ"
OK
127.0.0.1:6379> GET fuga
"\xe3\x83\x86\xe3\x82\xb9\xe3\x83\x88\xe3\x81\xa0\xe3\x82\x88"
```

### GET
上記ですでに使っている通りキーを指定して値を取得する。複数のキー指定はできないよう。

### PING
文字通り、死活監視コマンド。レスポンスが `PONG` でピンポンになるのがオサレ。

```sh
$ redis-cli PING
PONG
```

### LPUSH, RPUSH, LRANGE
`LPUSH` はリスト型の先頭に追加できるコマンド。  
`RPUSH` はリスト型の末尾に追加できるコマンド。  
`LRANGE` はリスト型の値を取得するコマンド

```sh
$ redis-cli LPUSH mylist a b c 1 2 3
(integer) 6
$ redis-cli LRANGE mylist 0 -1
1) "3"
2) "2"
3) "1"
4) "c"
5) "b"
6) "a"

$ redis-cli LPUSH mylist x y z
(integer) 9
$ redis-cli LRANGE mylist 0 -1
1) "z"
2) "y"
3) "x"
4) "3"
5) "2"
6) "1"
7) "c"
8) "b"
9) "a"

$ redis-cli RPUSH mylist 7 8 9
(integer) 12
$ redis-cli LRANGE mylist 0 -1
 1) "z"
 2) "y"
 3) "x"
 4) "3"
 5) "2"
 6) "1"
 7) "c"
 8) "b"
 9) "a"
10) "7"
11) "8"
12) "9"
